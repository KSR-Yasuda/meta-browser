From 527aac5048e1a02ade1cf75275c0538e57257e3d Mon Sep 17 00:00:00 2001
From: Martin Stransky <stransky@redhat.com>
Date: Thu, 29 Jun 2017 14:50:18 +0200
Subject: [PATCH 2/3] Removed the gdk_seat_* code - let's solve
 https://bugzilla.mozilla.org/show_bug.cgi?id=1377084 first

Signed-off-by: Hiroshi Hatake <hatake@clear-code.com>
---
 widget/gtk/nsWindow.cpp | 31 +++----------------------------
 1 file changed, 3 insertions(+), 28 deletions(-)

diff --git a/widget/gtk/nsWindow.cpp b/widget/gtk/nsWindow.cpp
index 027295e39911..ed28162d236f 100644
--- a/widget/gtk/nsWindow.cpp
+++ b/widget/gtk/nsWindow.cpp
@@ -4272,24 +4272,7 @@ nsWindow::NativeShow(bool aAction)
             if (mWindowType != eWindowType_invisible) {
                 SetUserTimeAndStartupIDForActivatedWindow(mShell);
             }
-
-            // TODO
-            if (0 && mWindowType == eWindowType_popup) {
-                mRetryPointerGrab = false;
-                //sRetryGrabTime = aTime;
-
-                GdkSeat *gdkSeat = gdk_display_get_default_seat(gdk_display_get_default());
-                gint retval = gdk_seat_grab(gdkSeat, gtk_widget_get_window(mShell),
-                                            GDK_SEAT_CAPABILITY_ALL_POINTING, TRUE,
-                                            nullptr, nullptr, show_shell, mShell);
-                MOZ_ASSERT(retval == GDK_GRAB_SUCCESS);
-                if (retval == GDK_GRAB_NOT_VIEWABLE) {
-                    mRetryPointerGrab = true;
-                } else if (retval != GDK_GRAB_SUCCESS) {
-                }
-            } else {
-                gtk_widget_show(mShell);
-            }
+            gtk_widget_show(mShell);
         }
         else if (mContainer) {
             gtk_widget_show(GTK_WIDGET(mContainer));
@@ -4789,12 +4772,7 @@ nsWindow::GrabPointer(guint32 aTime)
 
     if (!mGdkWindow)
         return;
-/*
-    GdkSeat *gdkSeat = gdk_display_get_default_seat(gdk_display_get_default());
-    gint retval;
-    retval = gdk_seat_grab(gdkSeat, mGdkWindow, GDK_SEAT_CAPABILITY_ALL_POINTING, TRUE,
-                           nullptr, nullptr, nullptr, nullptr);
-*/
+
     gint retval;
     retval = gdk_pointer_grab(mGdkWindow, TRUE,
                               (GdkEventMask)(GDK_BUTTON_PRESS_MASK |
@@ -4826,10 +4804,7 @@ nsWindow::ReleaseGrabs(void)
     LOG(("ReleaseGrabs\n"));
 
     mRetryPointerGrab = false;
-/*
-    GdkSeat *gdkSeat = gdk_display_get_default_seat(gdk_display_get_default());
-    gdk_seat_ungrab(gdkSeat);
-*/
+
     gdk_pointer_ungrab(GDK_CURRENT_TIME);
 }
 
-- 
2.11.0

