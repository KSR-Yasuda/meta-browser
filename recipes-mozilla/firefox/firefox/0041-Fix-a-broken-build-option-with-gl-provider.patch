From c54bbfb85d9423cb9666cff5e7336de48d454b40 Mon Sep 17 00:00:00 2001
From: Takuro Ashie <ashie@homa.ne.jp>
Date: Mon, 25 Apr 2016 15:52:53 +0900
Subject: [PATCH 41/44] Fix a broken build option "--with-gl-provider"

In the previous code, the configure option "--with-gl-provider" with a
supported provider name (such as EGL) causes a compile error because
the specified GLContextProvider is declared twice. In addition it's
also meaningless for unknown or unsupported providers because the
implementation for it doesn't exist in this case, so it causes a link
error.

Signed-off-by: Takuro Ashie <ashie@homa.ne.jp>
Signed-off-by: Hiroshi Hatake <hatake@clear-code.com>
---
 gfx/gl/GLContextProvider.h | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/gfx/gl/GLContextProvider.h b/gfx/gl/GLContextProvider.h
index 6e096c1f7e94..aaedb03cc9d8 100644
--- a/gfx/gl/GLContextProvider.h
+++ b/gfx/gl/GLContextProvider.h
@@ -65,10 +65,11 @@ namespace gl {
 #endif
 
 #ifdef MOZ_GL_PROVIDER
-  #define GL_CONTEXT_PROVIDER_NAME MOZ_GL_PROVIDER
-  #include "GLContextProviderImpl.h"
-  #undef GL_CONTEXT_PROVIDER_NAME
-  #define GL_CONTEXT_PROVIDER_DEFAULT MOZ_GL_PROVIDER
+// Force use the specified provider as the default one.
+// When an unknown or unsupported provider for the platform is specified, it
+// will cause a build error.
+#undef GL_CONTEXT_PROVIDER_DEFAULT
+#define GL_CONTEXT_PROVIDER_DEFAULT MOZ_GL_PROVIDER
 #endif
 
 #ifdef GL_CONTEXT_PROVIDER_DEFAULT
-- 
2.11.0

