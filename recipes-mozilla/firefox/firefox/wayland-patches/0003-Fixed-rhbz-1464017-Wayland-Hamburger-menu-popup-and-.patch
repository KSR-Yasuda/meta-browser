From daa6bcfb1f6d889202842a47ae7bf55caf5b8398 Mon Sep 17 00:00:00 2001
From: Martin Stransky <stransky@redhat.com>
Date: Fri, 23 Jun 2017 14:34:08 +0200
Subject: [PATCH 3/3] Fixed rhbz#1464017 - [Wayland] Hamburger menu popup and
 other panels does not render transparent background

Signed-off-by: Hiroshi Hatake <hatake@clear-code.com>
---
 widget/gtk/nsWindow.cpp | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/widget/gtk/nsWindow.cpp b/widget/gtk/nsWindow.cpp
index 666e3a9d2055..2eecd0a1108b 100644
--- a/widget/gtk/nsWindow.cpp
+++ b/widget/gtk/nsWindow.cpp
@@ -3832,7 +3832,11 @@ nsWindow::Create(nsIWidget* aParent,
         if (!shellHasCSD) {
             // Use mShell's window for drawing and events.
             gtk_widget_set_has_window(container, FALSE);
-            // Prevent GtkWindow from painting a background to flicker.
+        }
+
+        // Prevent GtkWindow from painting a background to flicker.
+        // On Wayland we need that for correct window rendering.
+        if (!shellHasCSD || !mIsX11Display) {
             gtk_widget_set_app_paintable(mShell, TRUE);
         }
         // Set up event widget
-- 
2.11.0

