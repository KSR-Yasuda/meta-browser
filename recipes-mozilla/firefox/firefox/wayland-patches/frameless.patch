From b515e6d36deaa6af6ad6c11b913332afd9ce7437 Mon Sep 17 00:00:00 2001
From: Takuro Ashie <ashie@clear-code.com>
Date: Tue, 27 Jun 2017 13:38:21 +0900
Subject: [PATCH] Don't show the window frames

The current EGL patch for Wayland doesn't work well when the
window frame exist. Until the issue is resolved, don't show
the frame and make the window fullscreen by default.

Signed-off-by: Takuro Ashie <ashie@clear-code.com>
---
 browser/app/profile/firefox.js                           | 2 +-
 browser/base/content/browser-fullScreenAndPointerLock.js | 4 ++--
 browser/base/content/browser.xul                         | 2 +-
 widget/gtk/nsWindow.cpp                                  | 1 +
 4 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/browser/app/profile/firefox.js b/browser/app/profile/firefox.js
index 026283b..03453b7 100644
--- a/browser/app/profile/firefox.js
+++ b/browser/app/profile/firefox.js
@@ -244,7 +244,7 @@ pref("browser.warnOnQuit", true);
 // might still show the window closing dialog with showQuitWarning == false.
 pref("browser.showQuitWarning", false);
 pref("browser.fullscreen.autohide", true);
-pref("browser.fullscreen.animate", true);
+pref("browser.fullscreen.animate", false);
 pref("browser.overlink-delay", 80);
 
 #ifdef UNIX_BUT_NOT_MAC
diff --git a/browser/base/content/browser-fullScreenAndPointerLock.js b/browser/base/content/browser-fullScreenAndPointerLock.js
index 497e511..fd827be 100644
--- a/browser/base/content/browser-fullScreenAndPointerLock.js
+++ b/browser/base/content/browser-fullScreenAndPointerLock.js
@@ -266,8 +266,8 @@ var FullScreen = {
       window.messageManager.addMessageListener(type, this);
     }
 
-    if (window.fullScreen)
-      this.toggle();
+    window.fullScreen = true;
+    this.toggle();
   },
 
   uninit: function() {
diff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul
index 2c74aec..7a11377e 100644
--- a/browser/base/content/browser.xul
+++ b/browser/base/content/browser.xul
@@ -58,7 +58,7 @@
         macanimationtype="document"
         screenX="4" screenY="4"
         fullscreenbutton="true"
-        sizemode="normal"
+        sizemode="fullscreen"
         retargetdocumentfocus="urlbar"
         persist="screenX screenY width height sizemode">
 
diff --git a/widget/gtk/nsWindow.cpp b/widget/gtk/nsWindow.cpp
index d97b350..4114a9d 100644
--- a/widget/gtk/nsWindow.cpp
+++ b/widget/gtk/nsWindow.cpp
@@ -3790,6 +3790,7 @@ nsWindow::Create(nsIWidget* aParent,
 
         // make sure this is the focus widget in the container
         gtk_widget_show(container);
+        gtk_window_set_decorated(GTK_WINDOW(mShell), FALSE);
         gtk_widget_grab_focus(container);
 
         // the drawing window
-- 
1.9.1

